# 테스트 모드 사용 가이드

개발 및 디버깅을 위한 테스트 모드 완전 가이드입니다.

## 📋 목차

1. [테스트 모드란?](#테스트-모드란)
2. [접근 방법](#접근-방법)
3. [주요 기능](#주요-기능)
4. [사용 시나리오](#사용-시나리오)
5. [디버깅 팁](#디버깅-팁)

---

## 테스트 모드란?

**테스트 모드**는 개발자와 테스터가 앱의 모든 기능을 실제 엿보기 상황 없이 테스트할 수 있는 특별한 모드입니다.

### 목적

✅ **빠른 기능 검증**
- 실제 카메라 없이 보호 메커니즘 테스트
- 위장 화면 미리보기
- 서비스 상태 확인

✅ **디버깅 지원**
- 실시간 로그 확인
- 서비스 초기화 상태 점검
- 권한 테스트

✅ **데모 및 프레젠테이션**
- 고객에게 기능 시연
- 빠른 프로토타입 검증
- 모든 위장 화면 쇼케이스

---

## 접근 방법

### 방법 1: 메인 화면에서

1. 앱 실행
2. 메인 화면 하단의 **🧪 테스트** 버튼 클릭

### 방법 2: 코드에서

```csharp
await Shell.Current.GoToAsync(nameof(Views.TestModePage));
```

---

## 주요 기능

### 1. 📊 서비스 상태 확인

**표시 정보**:
- ✅/❌ 얼굴 감지 서비스 초기화 여부
- 감지 횟수 카운터

**활용**:
- ONNX 모델 로드 확인
- 서비스 초기화 문제 진단

### 2. ⚡ 빠른 테스트

#### 보호 동작 선택
```
- 블러 효과
- 화면 가리기
- 위장 화면
- 진동만
```

#### 위장 화면 선택
```
- 뉴스
- 주식 시장
- 전자책
- 계산기
- 캘린더
```

#### 🎭 엿보기 감지 시뮬레이션
- 실제 엿보기 없이 보호 메커니즘 트리거
- 선택한 보호 동작 및 위장 화면 즉시 실행
- 진동 알림 테스트

**사용법**:
1. 보호 동작 선택
2. (위장 화면인 경우) 위장 타입 선택
3. "엿보기 감지 시뮬레이션" 버튼 클릭
4. 화면 전환 확인
5. "보호 해제" 버튼으로 복구

### 3. 👁️ 위장 화면 미리보기

5가지 위장 화면을 개별적으로 미리보기할 수 있습니다.

```
📰 뉴스 → 뉴스 피드 화면 표시
📈 주식 → 주식 시세 화면 표시
📖 전자책 → 독서 화면 표시
🧮 계산기 → 계산기 화면 표시
📅 캘린더 → 일정 화면 표시
```

**활용**:
- 각 템플릿 디자인 확인
- 데이터 표시 검증
- UI/UX 개선 작업

### 4. 🔧 서비스 테스트

#### 📷 카메라 권한 테스트
- 카메라 권한 요청 및 확인
- 권한 허용/거부 상태 로깅

**사용 시점**:
- 첫 실행 시
- 권한 문제 진단 시

#### 🤖 얼굴 감지 테스트
- ONNX 모델 초기화 확인
- 더미 이미지로 추론 테스트
- 감지 결과 확인 (얼굴 수, 엿보기 여부)

**출력 예시**:
```
[15:30:45] 얼굴 감지 서비스 테스트 시작...
- 서비스 초기화 중...
✅ 서비스 초기화 성공
- 테스트 이미지 생성 (320x240)
✅ 감지 완료: 1개 얼굴
- 엿보기 감지: 아니오
```

#### 🎬 모든 동작 테스트
모든 보호 동작을 자동으로 순차 테스트합니다.

**테스트 순서**:
1. 블러 효과 (2초)
2. 화면 가리기 (2초)
3. 위장 - 뉴스 (2초)
4. 위장 - 주식 (2초)
5. 위장 - 전자책 (2초)
6. 위장 - 계산기 (2초)
7. 위장 - 캘린더 (2초)
8. 진동만 (2초)

**활용**:
- 전체 기능 통합 테스트
- 데모 자동화
- 회귀 테스트

### 5. 📝 테스트 로그

실시간 로그가 표시됩니다.

**로그 내용**:
- 타임스탬프 (HH:mm:ss)
- 수행된 동작
- 서비스 상태
- 오류 메시지

**예시**:
```
테스트 로그:
[15:30:00] 테스트 모드 시작
- 얼굴 감지 서비스: 초기화됨
- 카메라 사용 가능: 예
[15:30:15] 엿보기 감지 시뮬레이션 #1
- 진동 알림 실행
- 보호 활성화: Disguise, 위장: News
[15:30:20] 보호 해제
```

**기능**:
- 🗑️ 초기화: 로그 지우기 및 카운터 리셋

---

## 사용 시나리오

### 시나리오 1: 개발 중 기능 검증

**목표**: 새로운 위장 화면이 제대로 작동하는지 확인

**단계**:
1. 테스트 모드 진입
2. "위장 화면 미리보기" 섹션에서 해당 위장 화면 클릭
3. 디자인 및 데이터 확인
4. 문제 발견 시 수정
5. 재테스트

### 시나리오 2: 클라이언트 데모

**목표**: 모든 보호 기능을 빠르게 시연

**단계**:
1. 테스트 모드 진입
2. "모든 동작 테스트" 클릭
3. 자동으로 모든 화면 순차 표시 (약 16초)
4. 클라이언트에게 다양한 옵션 소개

### 시나리오 3: 버그 재현

**목표**: 특정 조건에서 발생하는 버그 재현

**단계**:
1. 테스트 모드 진입
2. "서비스 테스트" → "얼굴 감지 테스트"
3. 로그 확인
4. 오류 메시지 분석
5. 수정 후 재테스트

### 시나리오 4: 권한 문제 진단

**목표**: 카메라 권한 관련 문제 해결

**단계**:
1. 테스트 모드 진입
2. "카메라 권한 테스트" 클릭
3. 권한 요청 다이얼로그 확인
4. 허용/거부 후 로그 확인
5. 문제 원인 파악

---

## 테스트 체크리스트

### 초기 설정 테스트

- [ ] ONNX 모델 다운로드 확인
- [ ] 얼굴 감지 서비스 초기화 확인
- [ ] 카메라 권한 허용 확인

### 보호 메커니즘 테스트

- [ ] 블러 효과 정상 작동
- [ ] 화면 가리기 정상 작동
- [ ] 위장 화면 - 뉴스 정상 표시
- [ ] 위장 화면 - 주식 정상 표시
- [ ] 위장 화면 - 전자책 정상 표시
- [ ] 위장 화면 - 계산기 정상 표시
- [ ] 위장 화면 - 캘린더 정상 표시
- [ ] 진동 알림 작동 확인

### UI/UX 테스트

- [ ] 화면 전환이 자연스러움
- [ ] 위장 화면 데이터가 그럴듯함
- [ ] 보호 해제가 정상 작동
- [ ] 로그가 정확히 기록됨

### 성능 테스트

- [ ] 얼굴 감지 속도 확인
- [ ] 화면 전환 속도 확인 (< 300ms)
- [ ] 메모리 사용량 확인
- [ ] 배터리 영향 측정

---

## 디버깅 팁

### 1. 서비스 초기화 실패

**증상**: "얼굴 감지 서비스: ❌ 미초기화"

**확인 사항**:
1. ONNX 모델 파일 존재 여부
   ```
   Resources/Raw/version-RFB-320.onnx
   ```
2. 파일 크기 확인 (약 1.2MB)
3. 빌드 설정 확인

**해결**:
```bash
# 모델 재다운로드
powershell -ExecutionPolicy Bypass -File Scripts/download-model.ps1

# Clean & Rebuild
dotnet clean
dotnet build
```

### 2. 위장 화면이 표시되지 않음

**확인 사항**:
1. DisguiseContainer가 제대로 렌더링되는지
2. 선택한 DisguiseType이 올바른지
3. View 파일이 존재하는지

**디버깅**:
```csharp
// MainPage.xaml.cs
private void LoadDisguiseScreen(DisguiseType disguiseType)
{
    System.Diagnostics.Debug.WriteLine($"Loading disguise: {disguiseType}");
    // ...
}
```

### 3. 진동이 작동하지 않음

**플랫폼별 확인**:
- **Android**: `AndroidManifest.xml`에 VIBRATE 권한 확인
- **iOS**: 물리 기기에서만 진동 가능 (시뮬레이터 불가)
- **Windows**: 진동 미지원

### 4. 로그가 너무 길어짐

**해결**:
- "초기화" 버튼으로 로그 클리어
- 또는 앱 재시작

---

## 고급 사용법

### 1. 커스텀 테스트 시나리오

TestModeViewModel에 추가:

```csharp
[RelayCommand]
private async Task CustomTestAsync()
{
    // 1. 특정 조건 설정
    SelectedTestAction = ProtectionAction.Disguise;
    SelectedTestDisguise = DisguiseType.News;
    
    // 2. 시뮬레이션 실행
    await SimulatePeekingAsync();
    
    // 3. 2초 대기
    await Task.Delay(2000);
    
    // 4. 자동 해제
    await DeactivateProtectionAsync();
}
```

### 2. 성능 측정

```csharp
[RelayCommand]
private async Task MeasurePerformanceAsync()
{
    var stopwatch = System.Diagnostics.Stopwatch.StartNew();
    
    for (int i = 0; i < 100; i++)
    {
        var dummyData = new byte[320 * 240 * 3];
        await _faceDetectionService.DetectFacesAsync(dummyData);
    }
    
    stopwatch.Stop();
    var avgTime = stopwatch.ElapsedMilliseconds / 100.0;
    
    AddLog($"평균 감지 시간: {avgTime:F2}ms");
    AddLog($"예상 FPS: {1000.0 / avgTime:F1}");
}
```

### 3. 메모리 테스트

```csharp
[RelayCommand]
private void CheckMemoryUsage()
{
    var memory = GC.GetTotalMemory(false) / 1024.0 / 1024.0;
    AddLog($"현재 메모리 사용량: {memory:F2} MB");
    
    GC.Collect();
    GC.WaitForPendingFinalizers();
    GC.Collect();
    
    var afterGC = GC.GetTotalMemory(true) / 1024.0 / 1024.0;
    AddLog($"GC 후 메모리: {afterGC:F2} MB");
}
```

---

## 테스트 시나리오 예시

### 기본 흐름 테스트

```
1. 테스트 모드 진입
2. 서비스 상태 확인
   ✅ 얼굴 감지 서비스: 정상
   ✅ 카메라: 사용 가능

3. 보호 동작: "위장 화면" 선택
4. 위장 타입: "뉴스" 선택
5. "엿보기 감지 시뮬레이션" 클릭
6. 확인:
   ✅ 진동 발생
   ✅ 뉴스 화면으로 전환
   ✅ 로그 기록됨

7. "보호 해제" 클릭
8. 확인:
   ✅ 원래 화면 복구
```

### 모든 위장 화면 테스트

```
1. 📰 뉴스 버튼 클릭
   → 뉴스 화면 확인
   → 기사 제목, 시간 확인
   → 스크롤 테스트

2. 📈 주식 버튼 클릭
   → 주식 화면 확인
   → 가격, 변동률 확인
   → 색상 표시 확인

3. 📖 전자책 버튼 클릭
   → 전자책 화면 확인
   → 내용 가독성 확인
   → 진행률 바 확인

4. 🧮 계산기 버튼 클릭
   → 계산기 화면 확인
   → 버튼 레이아웃 확인
   → iOS 스타일 확인

5. 📅 캘린더 버튼 클릭
   → 캘린더 화면 확인
   → 일정 표시 확인
   → 시간 형식 확인
```

### 통합 테스트

```
1. "모든 동작 테스트" 클릭
2. 자동 실행 관찰:
   - 8가지 조합 순차 실행
   - 각 화면 2초씩 표시
   - 총 소요 시간: ~20초

3. 로그 확인:
   - 모든 동작 기록 확인
   - 오류 없음 확인

4. 결과:
   ✅ 모든 테스트 통과
```

---

## 로그 분석

### 정상 동작 로그

```
테스트 로그:
[15:30:00] 테스트 모드 시작
- 얼굴 감지 서비스: 초기화됨
- 카메라 사용 가능: 예
[15:30:15] 엿보기 감지 시뮬레이션 #1
- 진동 알림 실행
- 보호 활성화: Disguise, 위장: News
[15:30:20] 보호 해제
[15:30:25] 뉴스 미리보기
```

### 오류 발생 로그

```
테스트 로그:
[15:30:00] 테스트 모드 시작
- 얼굴 감지 서비스: 미초기화
- 카메라 사용 가능: 예
[15:30:10] 얼굴 감지 서비스 테스트 시작...
- 서비스 초기화 중...
❌ 서비스 초기화 실패
❌ 오류: Model file not found
```

**해결**: ONNX 모델 다운로드 필요

---

## 프로덕션 빌드 시 주의사항

### DEBUG 모드에서만 활성화

```csharp
// MainPage.xaml
#if DEBUG
<Button Text="🧪 테스트"
        Command="{Binding OpenTestModeCommand}" />
#endif
```

### 또는 조건부 표시

```csharp
// MainViewModel.cs
public bool IsTestModeAvailable =>
#if DEBUG
    true;
#else
    false;
#endif
```

---

## 추가 테스트 도구

### 1. Visual Studio 진단 도구

- **메모리 프로파일러**: 메모리 누수 감지
- **CPU 프로파일러**: 병목 구간 찾기
- **네트워크 모니터**: API 호출 확인

### 2. 플랫폼별 도구

**Android**:
```bash
# Logcat으로 로그 확인
adb logcat | grep -i "MauiApp"

# 메모리 사용량
adb shell dumpsys meminfo [package-name]
```

**iOS**:
```bash
# Console 앱에서 로그 확인
# Instruments로 성능 측정
```

**Windows**:
- Event Viewer
- Performance Monitor
- Task Manager

---

## FAQ

### Q: 테스트 모드가 실제 감지를 방해하나요?

**A**: 아니요. 테스트 모드는 별도 페이지이며, 실제 감지 기능과 독립적입니다.

### Q: 모든 동작 테스트는 얼마나 걸리나요?

**A**: 약 20초 (8개 동작 × 2.5초)

### Q: 실제 기기에서 테스트해야 하나요?

**A**: 
- **에뮬레이터**: 대부분 기능 테스트 가능
- **실제 기기**: 카메라, 진동 테스트 시 필요

### Q: 로그를 파일로 저장할 수 있나요?

**A**: 향후 업데이트 예정. 현재는 화면 캡처로 대체.

---

## 결론

테스트 모드는 개발 생산성을 크게 향상시키는 도구입니다.

**핵심 이점**:
- ⚡ **빠른 검증**: 실제 엿보기 없이 모든 기능 테스트
- 🐛 **쉬운 디버깅**: 실시간 로그와 상태 확인
- 🎭 **완벽한 데모**: 자동화된 시연
- 📊 **성능 측정**: 서비스 벤치마크

**권장 워크플로우**:
```
코드 수정 → 빌드 → 테스트 모드 → 빠른 검증 → 실제 테스트 → 배포
```

---

**마지막 업데이트**: 2025년 10월  
**버전**: 1.0  
**작성자**: Anti-Peeking App Team

