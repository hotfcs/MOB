# 카메라 모드 및 얼굴 감지 상태 체크

메인 화면에서 직접 카메라를 활성화하고, 카메라와 얼굴 인식 상태를 확인할 수 있는 기능입니다.

## 📋 개요

**목적**: 
1. 실시간 카메라 프리뷰 표시
2. 얼굴 감지 기능 테스트
3. 시스템 상태 진단

**위치**: 메인 화면 하단 **📹 카메라 모드** 버튼

**기능**:
- 카메라 모드 활성화 → 전면 카메라 프리뷰 표시
- 상태 체크 → 시스템 진단 및 결과 표시

---

## 🔍 체크 항목

### 1. 📷 카메라 상태

#### 카메라 사용 가능 여부
- ✅ 예: 기기에 카메라가 있고 사용 가능
- ❌ 아니오: 카메라 하드웨어 없음

#### 카메라 권한
- ✅ 허용됨: 앱이 카메라에 접근 가능
- ❌ 거부됨: 권한이 필요함

**문제 해결**:
- 권한 거부 시 → 자동으로 권한 재요청
- 계속 거부 시 → 시스템 설정으로 이동 안내

### 2. 🤖 얼굴 인식 상태

#### 서비스 초기화
- ✅ 완료: ONNX 모델이 로드되어 사용 가능
- ❌ 미완료: 모델 로드 실패 또는 미설치

**자동 초기화**:
- 미초기화 상태면 자동으로 초기화 시도
- 초기화 성공/실패 결과 표시

#### 초기화 실패 시
```
⚠️ ONNX 모델 파일을 확인하세요:
  Resources/Raw/version-RFB-320.onnx
```

**해결 방법**:
```bash
# 모델 다운로드
powershell -ExecutionPolicy Bypass -File Scripts/download-model.ps1
```

### 3. 🔍 얼굴 감지 테스트

더미 데이터로 실제 감지 기능을 테스트합니다.

**테스트 내용**:
- 320x240 크기의 테스트 이미지 생성
- ONNX 모델로 추론 실행
- 감지된 얼굴 수 확인
- 엿보기 판단 로직 확인

**예상 결과**:
```
감지된 얼굴 수: 0~2개
엿보기 감지: 아니오 (또는 예)
```

### 4. 📊 전체 시스템 상태

모든 항목을 종합하여 시스템 준비 상태를 표시합니다.

**상태 표시**:
- **카메라**: ✅ 준비됨 / ❌ 준비 안됨
- **얼굴 감지**: ✅ 준비됨 / ❌ 준비 안됨
- **현재 감지 상태**: 🟢 활성화 / ⚪ 중지
- **감지 모드**: 현재 선택된 모드 표시

---

## 📱 사용 방법

### 카메라 모드 활성화

1. 메인 화면 하단 **📹 카메라 모드** 버튼 클릭
2. 카메라 권한 허용
3. 전면 카메라 프리뷰가 화면에 표시됨
4. 얼굴을 중앙 가이드에 맞춰 위치
5. 실시간 상태 정보 확인
6. **✖️ 카메라 모드 종료** 버튼으로 종료

### 상태 체크 실행

카메라 모드가 활성화된 상태에서:
1. 상단의 상태 정보 확인
2. 카메라 활성화 상태
3. 얼굴 감지 서비스 상태
4. 실시간 감지 진행 중 표시

### 결과 해석

#### ✅ 정상 상태 예시

```
📷 카메라 상태 체크...
  카메라 사용 가능: ✅ 예
  카메라 권한: ✅ 허용됨

🤖 얼굴 인식 상태 체크...
  서비스 초기화: ✅ 완료

🔍 얼굴 감지 테스트 실행...
  감지된 얼굴 수: 1개
  엿보기 감지: ✅ 아니오

📊 전체 시스템 상태:
  카메라: ✅ 준비됨
  얼굴 감지: ✅ 준비됨
  현재 감지 상태: ⚪ 중지
  감지 모드: 💼 사무실 모드 (측면/후면)
```

**해석**: 모든 시스템이 정상 작동 중! 감지를 활성화할 준비 완료

#### ❌ 문제 발견 예시

```
📷 카메라 상태 체크...
  카메라 사용 가능: ✅ 예
  카메라 권한: ❌ 거부됨

🤖 얼굴 인식 상태 체크...
  서비스 초기화: ❌ 미완료
  초기화 시도 중...
  초기화 결과: ❌ 실패

⚠️ ONNX 모델 파일을 확인하세요:
  Resources/Raw/version-RFB-320.onnx

📊 전체 시스템 상태:
  카메라: ❌ 준비 안됨
  얼굴 감지: ❌ 준비 안됨
  현재 감지 상태: ⚪ 중지
  감지 모드: 💼 사무실 모드 (측면/후면)
```

**해석**: 
1. 카메라 권한 필요 → 설정에서 권한 허용
2. ONNX 모델 미설치 → 다운로드 스크립트 실행

---

## 🛠️ 문제 해결

### 문제 1: 카메라 권한 거부

**증상**: `카메라 권한: ❌ 거부됨`

**해결**:
1. 다시 상태 체크 클릭 → 권한 재요청
2. 계속 거부되면:
   - **Android**: 설정 → 앱 → MOB → 권한 → 카메라 허용
   - **iOS**: 설정 → MOB → 카메라 허용
   - **Windows**: 설정 → 개인정보 → 카메라 → 앱 권한 허용

### 문제 2: 얼굴 인식 서비스 초기화 실패

**증상**: `서비스 초기화: ❌ 미완료` → `초기화 결과: ❌ 실패`

**원인**:
- ONNX 모델 파일 없음
- 파일 경로 오류
- 파일 손상

**해결**:
```bash
# 1. 모델 다운로드
powershell -ExecutionPolicy Bypass -File Scripts/download-model.ps1

# 2. 파일 확인
# Resources/Raw/version-RFB-320.onnx 존재 및 크기(1.2MB) 확인

# 3. Clean & Rebuild
dotnet clean
dotnet build
```

### 문제 3: 얼굴 감지가 0개

**증상**: `감지된 얼굴 수: 0개` (더미 데이터로 정상)

**설명**: 더미 데이터는 실제 얼굴이 없으므로 0개가 정상입니다.

**실제 테스트**:
1. 감지 활성화
2. 전면 카메라 앞에 얼굴 위치
3. 실시간 감지 확인

### 문제 4: 시스템 준비 안됨

**증상**: 
```
카메라: ❌ 준비 안됨
얼굴 감지: ❌ 준비 안됨
```

**체크리스트**:
- [ ] 카메라 하드웨어 확인
- [ ] 카메라 권한 허용
- [ ] ONNX 모델 다운로드
- [ ] 앱 재시작
- [ ] Clean & Rebuild

---

## 💡 사용 시나리오

### 시나리오 1: 첫 실행 시

```
목적: 앱이 정상 작동하는지 확인

1. 앱 설치 후 첫 실행
2. 🔍 상태 체크 클릭
3. 카메라 권한 요청 → 허용
4. 모든 상태 확인
5. ✅ 준비 완료 → 감지 활성화
```

### 시나리오 2: 문제 발생 시

```
목적: 감지가 작동하지 않는 원인 파악

1. 감지가 작동 안 함
2. 🔍 상태 체크 클릭
3. 문제 항목 확인 (❌ 표시)
4. 안내에 따라 해결
5. 다시 상태 체크로 확인
```

### 시나리오 3: 업데이트 후

```
목적: 업데이트가 정상 적용되었는지 확인

1. 앱 업데이트
2. 🔍 상태 체크 클릭
3. 모든 상태 정상 확인
4. 새 기능 사용 시작
```

### 시나리오 4: 다른 기기로 이동 시

```
목적: 새 기기에서 앱 설정 확인

1. 새 기기에 앱 설치
2. 🔍 상태 체크 클릭
3. 권한 허용 및 초기화 확인
4. 즉시 사용 시작
```

---

## 🔧 개발자 정보

### 구현 위치

**MainViewModel.cs**:
```csharp
[RelayCommand]
private async Task TestFaceDetectionAsync()
{
    // 1. 카메라 상태 체크
    // 2. 카메라 권한 체크
    // 3. 얼굴 인식 서비스 상태 체크
    // 4. 얼굴 감지 테스트
    // 5. 전체 시스템 상태
}
```

### 체크 흐름

```
버튼 클릭
    ↓
IsBusy = true (로딩 표시)
    ↓
카메라 Available 체크
    ↓
카메라 권한 요청
    ↓
얼굴 인식 초기화 확인
    ↓
(미초기화 시) 자동 초기화
    ↓
더미 데이터 감지 테스트
    ↓
결과 메시지 생성
    ↓
다이얼로그 표시
    ↓
IsBusy = false (로딩 해제)
```

### 에러 처리

```csharp
try
{
    IsBusy = true;
    // 체크 로직
}
catch (Exception ex)
{
    await Shell.Current.DisplayAlert(
        "테스트 오류",
        $"테스트 중 오류가 발생했습니다:\n{ex.Message}",
        "확인");
}
finally
{
    IsBusy = false;
}
```

---

## 📊 기대 효과

### 사용자 경험 개선

✅ **빠른 문제 진단**
- 한 번의 클릭으로 모든 상태 확인
- 명확한 문제 표시
- 해결 방법 안내

✅ **신뢰성 향상**
- 앱이 제대로 작동하는지 확인 가능
- 투명한 상태 정보 제공
- 사용자 불안감 해소

✅ **문제 해결 시간 단축**
- 무엇이 문제인지 즉시 파악
- 자동 초기화 시도
- 명확한 해결 가이드

### 개발자 경험 개선

✅ **디버깅 효율**
- 사용자 문제 재현 용이
- 상태 정보로 원인 파악
- 빠른 버그 수정

✅ **QA 테스트**
- 표준화된 체크리스트
- 자동화된 진단
- 일관된 테스트

---

## 비교: 테스트 모드 vs 상태 체크

### 이전 (테스트 모드)

```
- 별도 페이지 필요
- 복잡한 UI
- 많은 기능 (미리보기, 시뮬레이션 등)
- 개발자 중심
```

### 현재 (상태 체크)

```
✅ 메인 화면에서 직접 실행
✅ 간단한 다이얼로그
✅ 핵심 기능만 집중
✅ 사용자와 개발자 모두 활용
```

### 장점

| 항목 | 테스트 모드 | 상태 체크 |
|------|------------|----------|
| 접근성 | 별도 페이지 | 메인 화면 |
| 복잡도 | 높음 | 낮음 |
| 실행 속도 | 느림 | 빠름 |
| 사용자 친화성 | 낮음 | **높음** |
| 개발자 유용성 | 높음 | **높음** |

---

## 예시 출력

### 완벽한 상태

```
얼굴 감지 테스트 결과

📷 카메라 상태 체크...
  카메라 사용 가능: ✅ 예
  카메라 권한: ✅ 허용됨

🤖 얼굴 인식 상태 체크...
  서비스 초기화: ✅ 완료

🔍 얼굴 감지 테스트 실행...
  감지된 얼굴 수: 1개
  엿보기 감지: ✅ 아니오

📊 전체 시스템 상태:
  카메라: ✅ 준비됨
  얼굴 감지: ✅ 준비됨
  현재 감지 상태: ⚪ 중지
  감지 모드: 💼 사무실 모드 (측면/후면)
```

### 권한 문제

```
얼굴 감지 테스트 결과

📷 카메라 상태 체크...
  카메라 사용 가능: ✅ 예
  카메라 권한: ❌ 거부됨

🤖 얼굴 인식 상태 체크...
  서비스 초기화: ✅ 완료

🔍 얼굴 감지 테스트 실행...
  감지된 얼굴 수: 0개
  엿보기 감지: ✅ 아니오

📊 전체 시스템 상태:
  카메라: ❌ 준비 안됨
  얼굴 감지: ✅ 준비됨
  현재 감지 상태: ⚪ 중지
  감지 모드: 💼 사무실 모드 (측면/후면)
```

**조치**: 카메라 권한을 허용하세요.

### 모델 미설치

```
얼굴 감지 테스트 결과

📷 카메라 상태 체크...
  카메라 사용 가능: ✅ 예
  카메라 권한: ✅ 허용됨

🤖 얼굴 인식 상태 체크...
  서비스 초기화: ❌ 미완료
  초기화 시도 중...
  초기화 결과: ❌ 실패

⚠️ ONNX 모델 파일을 확인하세요:
  Resources/Raw/version-RFB-320.onnx

📊 전체 시스템 상태:
  카메라: ✅ 준비됨
  얼굴 감지: ❌ 준비 안됨
  현재 감지 상태: ⚪ 중지
  감지 모드: 💼 사무실 모드 (측면/후면)
```

**조치**: ONNX 모델을 다운로드하세요.

---

## 📈 활용 팁

### Tip 1: 정기적인 체크

앱 업데이트 후, 설정 변경 후, 문제 발생 시 정기적으로 상태 체크를 실행하세요.

### Tip 2: 문제 해결 순서

1. 🔍 상태 체크로 문제 파악
2. 안내에 따라 조치
3. 다시 상태 체크로 해결 확인
4. 반복

### Tip 3: 고객 지원 시

사용자가 문제를 보고하면:
1. "🔍 상태 체크 버튼을 눌러주세요"
2. 결과 화면 캡처 요청
3. 즉시 문제 원인 파악

---

## 🎯 결론

**얼굴 감지 상태 체크**는 간단하지만 강력한 진단 도구입니다.

**핵심 가치**:
- 🚀 **빠름**: 2-3초 만에 전체 점검
- 🎯 **정확함**: 명확한 문제 식별
- 💡 **유용함**: 사용자와 개발자 모두에게
- 🔧 **실용적**: 실제 문제 해결에 도움

**권장 사용 시기**:
- ✅ 앱 첫 실행 시
- ✅ 문제 발생 시
- ✅ 업데이트 후
- ✅ 설정 변경 후
- ✅ 정기 점검

---

**마지막 업데이트**: 2025년 10월  
**버전**: 1.0  
**작성자**: Anti-Peeking App Team

